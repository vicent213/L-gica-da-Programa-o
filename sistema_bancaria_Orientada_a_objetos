using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading;

namespace banco_OrientadaObjetos
{
     
    public class Cliente
        {
            //int ID; - implementar depois 
            public string Nome {get; set;}
            public string CPF { get; protected set;}
            public List<ContaBancaria> Contas { get;set;} = new List<ContaBancaria>();
                
                
              //construtor da cliente  
            public Cliente (string Nome, string CPF)
            {
                this.Nome = Nome;
                this.CPF= CPF;
                 
            }

            public void InfoCliente()
            {
                Console.WriteLine($"Cliente: {Nome}, CPF: {CPF} ");

                foreach (ContaBancaria conta in Contas)
                {
                Console.WriteLine($"Número da conta: {conta.NumeroConta}, Tipo: {conta.tipo}");
                }

            }
    }
       
    public abstract class ContaBancaria
    {
        public int NumeroConta { get; protected set;}
        public double Saldo { get; protected set;}
        public string tipo;
        public string NumeroCheque { get;protected set;}
            
             //construtor conta bancaria
        public ContaBancaria( int NumeroConta, double saldoInicial, string tipo)
        {
            this.NumeroConta = NumeroConta;
            Saldo = saldoInicial;
            this.tipo = tipo;
            
            
        }
        
        //metodos
        public virtual void Depositar(double valor)
        {
            
            if (valor > 0)
            {
                if (valor >= 1000)
                {
                    Saldo = valor + 500;
                    Console.WriteLine($"Deposito realizado. Novo saldo:{Saldo} bonus de R$500 realizado!");
                } else
                {
                    Saldo += valor;
                    Console.WriteLine($"Deposito realizado. Novo saldo:{Saldo}");
                }
            }
            else
            {
                Console.WriteLine("Deposito nao efetuado, o valor deve ser positivo");
            }
        }

        public virtual void DepositarCheque(double valor, string NumeroCheque)
        {
         if (valor<= 0)
            {
                Console.WriteLine("Por favor, digite um valor válido!");
            }
            if (NumeroCheque.Length != 9)
            {
               Console.WriteLine("Por favor, digite um número de cheque válido");
            }

            Saldo+= valor;

            Console.Write($"Depósito de cheque de R${valor}, Cheque {NumeroCheque} realizado com sucesso!");
        }

        public virtual void Sacar(double valor)
        {
            if(valor>0 && valor<= Saldo)//garantir que nao excede o saldo
            {
                Saldo -= valor;
                Console.WriteLine($"Saque realizado. Novo saldo: {Saldo}");
            } else if (valor > Saldo)
            {
                Console.WriteLine("saldo insuficiente para realizar saque");
            }
            else
            {
                Console.WriteLine("Valor do saque deve ser positivo");
            }
        }
 
    }  

    public class ContaCorrente: ContaBancaria
        {
        
         public ContaCorrente(int numeroConta, double saldo, string tipo = "Conta Corrente")
                : base(numeroConta, saldo, tipo)
            {
                        }
    }

    public class ContaPoupanca: ContaBancaria
    {
        
        public ContaPoupanca(int numeroConta, double saldo, string tipo = "Conta Poupança")
            : base(numeroConta, saldo, tipo)
        {
            
        }        
    }

    public class Banco
    {
        private List<Cliente> clientes = new List<Cliente>();
        private List<ContaBancaria> _contas = new List<ContaBancaria>();
        private int _proxNumeroConta = 1;
        
        public bool VerificarCPF(string cpf)
        {
            //cpf tem que ter 11 digitos;
            if (cpf.Length == 11)
            {
               return true;
            }
            else //cpf nao tem 11 dgitos
            {
                return false;
            }

        } 

        public void ListarClientes()
        {
            Console.WriteLine("\n Clientes Cadastrados");
            if(clientes.Count == 0)
            {
                Console.WriteLine("nenhum cliente cadastrado");
            }
            else
            {
                foreach(var cliente in clientes)
                {
                    Console.WriteLine($"cpf:{cliente.CPF}, nome: {cliente.Nome}");
                }
            }
        }

        public void CadastrarCliente()
        {
            Console.WriteLine("Digite o nome do cliente: ");
            string nome = Console.ReadLine();
            Console.WriteLine("Digite o cpf do cliente: ");
            string CPF = Console.ReadLine();

            if (VerificarCPF(CPF))
            {
                foreach (Cliente clienteCadastrado in clientes)
                {
                    if (clienteCadastrado.CPF == CPF)
                    {
                        Console.WriteLine("ja existe um cliente cadastrado");
                        return;
                    }

                }
                Console.Clear();
                Cliente novoCliente = new Cliente(nome, CPF);
                clientes.Add(novoCliente);
                Console.WriteLine($"Cliente {nome} cadastrado com sucesso!");

            }
            else
            {
                Console.WriteLine("Por favor, digite um cpf válido");
              
            }
        }

        public void ListarContaClientes()
        {
            Console.Clear();
            Console.WriteLine("Clientes cadastrados e suas contas associadas: ");

            if (clientes.Count == 0)
            {
                Console.WriteLine("nenhum cliente cadastrado");
                return;
            }

            foreach (var cliente in clientes)
            {
                Console.WriteLine($"{cliente.Nome}");

                foreach (var conta in cliente.Contas)
                {
                    Console.WriteLine($"Contas associada: {conta.NumeroConta}, {conta.tipo} ");
                    
                }
            }
        }

        public void CriarContaParaClientes()
        {
            Console.Clear();
            Console.Write("Digite o CPF do cliente para qual deseja criar a conta:");
            string cpf = Console.ReadLine();

            Console.WriteLine("Digite o numero da conta: ");
            int numeroConta = Convert.ToInt32(Console.ReadLine());

            Console.WriteLine("Digite qual opção de conta: 1- Poupança 2- Corrente");
            int tipo = Convert.ToInt32(Console.ReadLine());
        
            Cliente cliente = clientes.Find(c => c.CPF == cpf);

            if (cliente == null)
            {
                Console.WriteLine("erro : cliente nao encontrado!");
                return;
            }
            if (tipo == 1)
            {
                ContaBancaria novaConta = new ContaPoupanca(numeroConta, 0);
                cliente.Contas.Add(novaConta);

            }
            if (tipo == 2)
            {
                ContaBancaria novaConta = new ContaCorrente(numeroConta, 0);
                cliente.Contas.Add(novaConta);
            }
            Console.WriteLine("Conta criada com sucesso!");
            

        }

           public void ConsultarSaldo()
           {
            Console.WriteLine("Digite o cpf do Cliente");
            string CPF = Console.ReadLine();
            Console.WriteLine ("Digite a conta do cliente: ");
            int numeroConta = Convert.ToInt32(Console.ReadLine());


            foreach (Cliente cliente in clientes)
            {
                if (CPF == cliente.CPF)
                {
                    foreach  (ContaBancaria conta in cliente.Contas)
                    {
                       if (conta.NumeroConta == numeroConta)
                        {
                            Console.WriteLine($"o saldo dessa conta é : {conta.Saldo}"); 
                        }
                    }
                }
            }
           }

         public void RealizarDeposito()
            {
            Console.WriteLine("Digite o cpf do Cliente: ");
            string CPF = Console.ReadLine();
            Console.WriteLine("Digite a conta do cliente: ");
            int numeroConta = Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("Digite o valor para deposito: ");
            double valor = Convert.ToInt32(Console.ReadLine());

            foreach (Cliente cliente in clientes)
            {
                if (CPF == cliente.CPF)
                {
                    foreach (ContaBancaria conta in cliente.Contas)
                    {
                        if (conta.NumeroConta == numeroConta)
                        {   
                            
                            conta.Depositar(valor);
                            Console.WriteLine($"Deposito realizado!");
                        }
                    }
                }
            }
        }
        public void RealizarChequeDeposito()
        {
            Console.WriteLine("Digite o cpf do cliente: ");
            string CPF = Console.ReadLine();
            Console.WriteLine("Digite a conta do cliente: ");
            int numeroConta= Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("Digite o valor do deposito: ");
            double valor = Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("Digite o número do cheque: ");
            int numeroCheque = Convert.ToInt32(Console.ReadLine());

            foreach (Cliente cliente in clientes)
            {
                if (CPF == cliente.CPF)
                {
                    foreach(ContaBancaria conta in cliente.Contas)
                    {
                        if(conta.DepositarCheque == d)
                    }
                }
            }

        }

        public void EfetuarTransferencia()
        {
            Console.WriteLine("Digite a conta de origem: ");
            int NumeroContaOrigem = Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("Digite numero da conta de destino para transferencia: ");
            int numeroContaDestino = Convert.ToInt32(Console.ReadLine());
            Console.WriteLine("Digite o valor para a conta de destino: ");
            double valor = Convert.ToInt32(Console.ReadLine());

            foreach (Cliente cliente in clientes)
            {
                foreach(ContaBancaria conta in cliente.Contas)
                {
                    if(conta.NumeroConta == NumeroContaOrigem)
                    {
                          conta.Sacar(valor);
                    }        
                }
            }

            foreach (Cliente cliente in clientes)
            {
                foreach (ContaBancaria conta in cliente.Contas)
                {
                    if (conta.NumeroConta == numeroContaDestino)
                    {
                            conta.Depositar(valor);
                     }
                    
                 }
                
            }

        }
        public void EfetuarSaque()
        {
         Console.WriteLine("Digite o cpf do Cliente");
         string CPF = Console.ReadLine();
         Console.WriteLine("Digite a conta do cliente: ");
         int numeroConta = Convert.ToInt32(Console.ReadLine());
         Console.WriteLine("Digite o valor para saque: ");
         double valor = Convert.ToInt32(Console.ReadLine());
            foreach (Cliente cliente in clientes)
            {
                if (CPF == cliente.CPF)
                {
                    foreach (ContaBancaria conta in cliente.Contas)
                    {
                        if (conta.NumeroConta == numeroConta)
                        {
                            conta.Sacar(valor);
                            Console.WriteLine($"Saque realizado realizado!");
                        }
                    }
                }
            }


        }
       
      public void ImprimirInfoCliente()
        {
            Console.WriteLine("Informar CPF: ");
            string cpf = Console.ReadLine();
            bool clienteEncontrado = false;
            foreach (Cliente cliente in clientes)
            {
                if(cliente.CPF == cpf)
                {
                    cliente.InfoCliente();
                    clienteEncontrado = true;
                }
            
            }

            if (!clienteEncontrado)
            {
               Console.WriteLine("Por favor, informar CPF cadastrado.");
            }
        }  
    }  
    
    class App
    {

        private static List<Cliente> clientes = new List<Cliente>();
        private static int proximoNumeroConta= 001;

        static void Main()
        {

      Banco banco = new Banco();
      bool sair = false;
      while (!sair)
      {
       Thread.Sleep(2000);
        Console.Clear();
        Console.WriteLine("================== Sistema Bancario ===========================");
        Console.Write("Selecione alguma das opções para Prosseguir: ");
        Console.WriteLine("\n1- Cadastrar Cliente");
        Console.WriteLine("\n2- Cadastrar conta para cliente");
        Console.WriteLine("\n3- Listar Clientes");
        Console.WriteLine("\n4- Consultar saldo da conta");
        Console.WriteLine("\n5- Efetuar deposito");
        Console.WriteLine("\n6- Efetuar transferência");
        Console.WriteLine("\n7- Efetuar saque");
        Console.WriteLine("\n8- Informações do Cliente");
        Console.WriteLine("");
        
        int opcaoPrincipal = Convert.ToInt32(Console.ReadLine());

        switch (opcaoPrincipal)
        {
          case 1:
            banco.CadastrarCliente();
            break;
          case 2:
            banco.CriarContaParaClientes();
            break;

          case 3:
            banco.ListarContaClientes();
            break;

          case 4:
            banco.ConsultarSaldo();
              break;
          
           case 5:
             banco.RealizarDeposito();
             break;

          case 6:
              banco.EfetuarTransferencia();
              break;
          
         case 7:
              banco.EfetuarSaque();
              break;
                            
         case 8:
            banco.ImprimirInfoCliente();
            break;
          
         case 9:
             banco.RealizarChequeDeposito();
             break;
         
         default:
         Console.WriteLine("Opção invalida!");
         break;
        }

        

      }

    }
   }

}
